<!DOCTYPE HTML>
<html>
	<head>
		<title>GodotSteam - A Steamworks Module For Godot Engine | By Gramps | GitHub</title>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="css/main.css?v=2.7" />
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
		<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<!--[if lt IE 8]>
		<link rel="stylesheet" href="{{ '/css/ie.css' | relative_url }}">
		<![endif]-->
	</head>
	<body class="is-preload">
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo"><strong>GodotSteam</strong> A Steamworks module for Godot Engine</a>
					</header>
					<section>
	<header class="main">
		<h1>Tutorials - Lobby Auto-Matchmaking</h1>
	</header>
	<p>A quick, requested tutorial is auto-matchmaking lobbies. While this example does not show how to match specific criteria, it will be noted where you can place such matches. This tutorial is basically an extention of the <a href="tutorials-lobbies-p2p.html" target="_blank">lobbies / P2P tutorial</a>. Because of that we'll focus only on what's different; please refer to the lobby tutorial for additional information and layouts.</p>
	<header class="major">
		<h3>Set Up</h3>
	</header>
	<p>First let's set up some variables to fill in later:</p>
<pre><code>
var STEAM_LOBBY_ID: int = 0
var LOBBY_MEMBERS: Array = []
var MATCHMAKING_PHASE: int = 0
var LOBBY_MAX_PLAYERS: int = 2
</code></pre>
	<p>Carried over from the lobby tutorial is <strong>STEAM_LOBBY_ID</strong>, which obviously houses the lobby's ID, and <strong>LOBBY_MEMBERS</strong>, which will be an array of dictionaries of lobby members and their Steam ID 64's.</p>
	<p>New to this tutorial is <strong>MATCHMAKING_PHASE</strong> which keeps track of which iteration of the matchmaking search our code does.  Also new is <strong>LOBBY_MAX_PLAYERS</strong> which is used to check if the lobby has space for our player.</p>
	<p>All of the _ready function callback connections will be the same.</p>
	<hr/>
	<header class="major">
		<h3>Finding A Lobby</h3>
	</header>
	<p>For our purposes, we will create a button named "Auto Matchmake" and connect a _on_pressed signal to it called _on_Auto_Matchmake_pressed().  Here is the function that triggers when that button is pressed:</p>
<pre><code>
# Start the auto matchmaking process.
func _on_Auto_Matchmake_pressed() -> void:
	# Set the matchmaking process over
	MATCHMAKE_PHASE = 0
	# Start the loop!
	_matchmaking_Loop()
</code></pre>			
	<p>This, obviously, starts the main loop that looks for a matching lobby for your player to join:</p>
<pre><code>
# Iteration for trying different distances
func _matchmaking_Loop() -> void:
	# If this matchmake_phase is 3 or less, keep going
	if MATCHMAKE_PHASE < 4:
		###
		# Add other filters for things like game modes, etc.
		# Since this is an example, we cannot set game mode or text match features.
		# However you could use addRequestLobbyListStringFilter to look for specific
		# text in lobby metadata to match different criteria.

		###
		# Set the distance filter
		Steam.addRequestLobbyListDistanceFilter(MATCHMAKE_PHASE)

		# Request a list
		Steam.requestLobbyList()

	else:
		print("[STEAM] Failed to automatically match you with a lobby. Please try again.\n")
</code></pre>
	<p>As it notes in the code above, you could have a list of different filters the player can pick from before searching for a lobby. These can be applied to terms that <strong>addRequestLobbyListStringFilter</strong> looks for ahead of time. Things like game modes, maps, difficulties, etc.</p>
	<p>Very important is our <strong>addRequestLobbyListDistanceFilter</strong> and <strong>MATCHMAKE_PHASE</strong> variable. We are starting with "close" / 0 and ending with "worldwide" 3; hence at 4 it fails to find anything and prompts the user to try again.</p>
	<p>This loop function will trigger a callback once it finds some lobbies to check through. Sorting through our matches should look like this:</p>
<pre><code>
# A lobby list was created, find a possible lobby
func _on_Lobby_Match_List(lobbies: Array) -> void:
	# Set attempting_join to false
	var ATTEMPTING_JOIN: bool = false

	# Show the list 
	for LOBBY in lobbies:
		# Pull lobby data from Steam
		var LOBBY_NAME: String = Steam.getLobbyData(LOBBY, "name")
		var LOBBY_NUMS: int = Steam.getNumLobbyMembers(LOBBY)

		###
		# Add other filters for things like game modes, etc.
		# Since this is an example, we cannot set game mode or text match features.
		# However, much like lobby_name, you can use Steam.getLobbyData to get other
		# preset lobby defining data to append to the next if statement.
		###

		# Attempt to join the first lobby that fits the criteria
		if LOBBY_NUMS < LOBBY_MAX_PLAYERS and not ATTEMPTING_JOIN:
			# Turn on attempting_join
			ATTEMPTING_JOIN = true
			print("Attempting to join lobby...\n")
			Steam.joinLobby(LOBBY)

	# No lobbies that matched were found, go onto the next phase
	if not ATTEMPTING_JOIN:
		# Increment the matchmake_phase
		MATCHMAKE_PHASE += 1
		_matchmaking_Loop()
</code></pre>
	<p>This will go through every lobby returned and, if none of them match, it will iterate the <strong>MATCHMAKE_PHASE</strong> variable and start the loop again but moving one step further in the distance filter.</p>
	<p>Much like the previous additional filters, you can sort by other lobby data in the manner the <strong>LOBBY_NAME</strong> data is acquired. These bits of information can be added to a lobby when it is created, making this process easier.</p>
	<p>The first lobby that matches your criteria and has space for the user, triggers the <strong>joinLobby</strong> function to fire and the player should soon join their automatically found lobby.</p>
	<hr/>
	<p><a href="https://github.com/Gramps/GodotSteam/tree/example" target="_blank">To see this tutorial in action, check out the example branch on the GodotSteam Github repo.</a> There you can get a full view of the code used which can serve as a starting point for you to branch out from.</p>
</section>					<a href="#" id="to-top" class="display:none;"><i class="fas fa-arrow-alt-circle-up"></i></a>
				</div>
			</div>
			<!-- Sidebar -->
			<div id="sidebar">
	<div id="sidebar-inner" class="inner">
		<!-- Menu -->
		<nav id="menu">
			<header class="major">
				<h2>Menu</h2>
			</header>
			<ul>
				<li><a href="index.html">Introduction</a></li>
				<li>
					<span class="opener">How-To's</span>
					<ul>
						<li><a href="howto-module.html">How-To Godot 2, 3, 4</a></li>
						<li><a href="howto-gdnative.html">How-To GDNative</a></li>
					</ul>
				</li>
				<li>
					<span class="opener">Functions</span>
					<ul>
						<li><a href="functions-main.html">Main</a></li>
						<li><a href="functions-apps.html">Apps</a></li>
						<li><a href="functions-apps-list.html">App Lists</a></li>
						<li><a href="functions-friends.html">Friends</a></li>
						<li><a href="functions-game-search.html">Game Search</a></li>
						<li><a href="functions-game-server.html">Game Server</a></li>
						<li><a href="functions-game-server-stats.html">Game Server Stats</a></li>
						<li><a href="functions-html-surface.html">HTML Surface</a></li>
						<li><a href="functions-http.html">HTTP</a></li>
						<li><a href="functions-input.html">Input</a></li>
						<li><a href="functions-inventory.html">Inventory</a></li>
						<li><a href="functions-matchmaking.html">Matchmaking</a></li>
						<li><a href="functions-matchmaking-servers.html">Matchmaking Servers</a></li>
						<li><a href="functions-music.html">Music</a></li>
						<li><a href="functions-music-remote.html">Music Remote</a></li>
						<li><a href="functions-networking.html">Networking</a></li>
						<li><a href="functions-networking-messages.html">Networking Messages</a></li>
						<li><a href="functions-networking-sockets.html">Networking Sockets</a></li>
						<li><a href="functions-networking-types.html">Networking Types</a></li>
						<li><a href="functions-networking-utils.html">Networking Utils</a></li>
						<li><a href="functions-parental-settings.html">Parental Settings</a></li>
						<li><a href="functions-parties.html">Parties</a></li>
						<li><a href="functions-remote-play.html">Remote Play</a></li>
						<li><a href="functions-remote-storage.html">Remote Storage</a></li>
						<li><a href="functions-screenshots.html">Screenshots</a></li>
						<li><a href="functions-ugc.html">UGC</a></li>
						<li><a href="functions-user.html">User</a></li>
						<li><a href="functions-user-stats.html">User Stats</a></li>
						<li><a href="functions-utils.html">Utils</a></li>
						<li><a href="functions-video.html">Video</a></li>
					</ul>
				</li>
				<li>
					<span class="opener">Signals</span>
					<ul>
						<li><a href="signals-main.html">Main</a></li>
						<li><a href="signals-apps.html">Apps</a></li>
						<li><a href="signals-apps-list.html">Apps List</a></li>
						<li><a href="signals-friends.html">Friends</a></li>
						<li><a href="signals-game-search.html">Game Search</a></li>
						<li><a href="signals-game-server.html">Game Server</a></li>
						<li><a href="signals-game-server-stats.html">Game Server Stats</a></li>
						<li><a href="signals-html-surface.html">HTML Surface</a></li>
						<li><a href="signals-http.html">HTTP</a></li>
						<li><a href="signals-input.html">Input</a></li>
						<li><a href="signals-inventory.html">Inventory</a></li>
						<li><a href="signals-matchmaking.html">Matchmaking</a></li>
						<li><a href="signals-matchmaking-servers.html">Matchmaking Servers</a></li>
						<li><a href="signals-music-remote.html">Music Remote</a></li>
						<li><a href="signals-networking.html">Networking</a></li>
						<li><a href="signals-networking-sockets.html">Networking Sockets</a></li>
						<li><a href="signals-networking-utils.html">Networking Utils</a></li>
						<li><a href="signals-parental-settings.html">Parental Settings</a></li>
						<li><a href="signals-parties.html">Parties</a></li>
						<li><a href="signals-remote-play.html">Remote Play</a></li>
						<li><a href="signals-remote-storage.html">Remote Storage</a></li>
						<li><a href="signals-screenshots.html">Screenshots</a></li>
						<li><a href="signals-ugc.html">UGC</a></li>
						<li><a href="signals-user.html">User</a></li>
						<li><a href="signals-user-stats.html">User Stats</a></li>
						<li><a href="signals-utils.html">Utils</a></li>
						<li><a href="signals-video.html">Video</a></li>
					</ul>
				<li>
					<span class="opener">Godot 3.x Tutorials</span>
					<ul>
						<li><a href="tutorials-initializing.html">Initializing Steam</a></li>
						<li><a href="tutorials-stats-achievements.html">Stats and Achievements</a></li>
						<li><a href="tutorials-leaderboards.html">Leaderboards</a></li>
						<li><a href="tutorials-avatars.html">Avatars</a></li>
						<li><a href="tutorials-lobbies-p2p.html">Lobbies / P2P Networking</a></li>
						<li><a href="tutorials-authentication.html">Authentication</a></li>
						<li><a href="tutorials-mac-export.html">Mac Exporting</a></li>
						<li><a href="tutorials-achievement-icons.html">Achievement Icons</a></li>
						<li><a href="tutorials-auto-matchmaking.html">Auto-Matchmaking</a></li>
						<li><a href="tutorials-rich-presence.html">Rich Presence</a></li>
						<li><a href="tutorials-linux-caveats.html">Linux Caveats</a></li>
						<li><a href="tutorials-exporting-shipping.html">Exporting and Shipping</a></li>
						<li><a href="tutorials-remove-steam.html">Remove Steam</a></li>
					</ul>
				</li>
				<li><a href="games.html">Games Using GodotSteam</a></li>
				<li><a href="https://github.com/Gramps/GodotSteam/projects/1.html" target="_blank">To-Do</a></li>
				<li>
					<span class="opener">Change Log</span>
					<ul>
						<li><a href="changelog-godot4.html">Godot 4.x</a></li>
						<li><a href="changelog-godot3.html">Godot 3.x</a></li>
						<li><a href="changelog-godot2.html">Godot 2.x</a></li>
						<li><a href="changelog-gdnative.html">GDNative</a></li>
					</ul>
				</li>
				<li><a href="contributors.html">Contributors</a></li>
			</ul>
		</nav>
		<section>
			<header class="major">
				<h2>Stuck? Need Help?</h2>
			</header>
			<p>Navigating Steamworks can be confusing sometimes. If you run across any problems, there's a few ways to get it ironed out.</p>
			<ul class="actions stacked">
				<li><a class="button primary" href="mailto:godotsteam@coaguco.com" target="_blank"><i class="fas fa-envelope-open-text"></i>&nbsp;&nbsp;Send A Support E-Mail</a></li>
				<li><a class="button primary" href="https://discord.gg/SJRSq6K" target="_blank"><i class="fab fa-discord"></i>&nbsp;&nbsp;Chat With Us On Discord</a></li>
			</ul>
		</section>
		<section>
			<header class="major">
				<h2>Donate</h2>
			</header>
			<p>If C++ is not your bag but you're feeling generous, you can support the project with your pocket change using either button below!</p>
			<ul class="actions stacked">
				<li><a class="button primary" href="https://patreon.com/coaguco" target="_blank"><i class="fab fa-patreon"></i>&nbsp;&nbsp;Donate with Patreon</a></li>
				<li><a class="button primary" href="https://www.paypal.me/sithlordkyle" target="_blank"><i class="fab fa-paypal"></i>&nbsp;&nbsp;Donate with Paypal</a></li>
			</ul>
		</section>
		<footer>
			<ul class="actions stacked">
				<li>Godot Engine by <a href="https://godotengine.org">Juan Linietsky, Ariel Manzur and contributors</a></li>
				<li>Steamworks API by <a href="https://valvesoftware.com">Valve Corporation</a></li>
				<li>GodotSteam by <a href="https://coaguco.com">GP Garcia</a> and contributors</li>
				<li>Site Template by <a href="https://html5up.net">HTML5UP</a></li>
			</ul>
		</footer>
		<footer id="footer" class="copyright">
			2022 &copy; GP Garcia & CoaguCo Industries
		</footer>
	</div>
</div>		</div>
		<!-- Scripts -->
		<script src="js/jquery.min.js"></script>
		<script src="js/browser.min.js"></script>
		<script src="js/breakpoints.min.js"></script>
		<script src="js/util.js"></script>
		<script src="js/main.js"></script>
		<script src="js/godotsteam.js"></script>
	</body>
</html>
